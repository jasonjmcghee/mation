var Ge=Object.defineProperty;var Ye=(r,e,t)=>e in r?Ge(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>(Ye(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const{FFmpeg:qe}=window.FFmpegWASM,V=new qe,Ae=3005;document.addEventListener("DOMContentLoaded",async()=>{await V.load({coreURL:"/libs/ffmpeg/ffmpeg-core.js",wasmURL:"/libs/ffmpeg/ffmpeg-core.wasm"}),console.log("FFmpeg loaded")});function Ze(){const r=["mp4","zip"];return(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&r.push("node_mp4"),r}async function Oe(r,e={}){const{framerate:t=60,codec:i="libx264",outputFile:a="out.mp4",onProgress:n,outputFormat:s="mp4"}=e,o=r.getDuration(),l=[],u=1/t;for(let _=0;_<=o+u;_+=u)l.push(_);const d=r.playing();r.pause(),r.seekToTime(0);const c=1/l.length,f=[],v=[];for(let _=0;_<l.length;_++){r.renderAtTime(l[_]);const T=await new Promise(p=>r.canvas.toBlob(y=>{p(y)})),m=`frame_${_.toString().padStart(6,"0")}.png`;v.push(m),s==="mp4"?V.writeFile(m,new Uint8Array(await T.arrayBuffer())):f.push(T),n&&n((s==="mp4"?.3:.9)*(_*c))}if(n&&n(s==="mp4"?.3:.9),s==="mp4"){V.on("progress",({progress:y})=>{if(n){const b=.3+y*.7;n(b)}}),V.on("log",y=>{console.log(`ffmpeg log: ${JSON.stringify(y)}`)}),await V.exec(["-framerate",String(t),"-pattern_type","glob","-i","*.png","-c:v",i,"-preset","medium","-pix_fmt","yuv420p","-crf","18",a]),n&&n(.9);const _=await V.readFile(a),T=new Blob([_.buffer],{type:"video/mp4"}),m=URL.createObjectURL(T),p=document.createElement("a");p.href=m,p.download=a,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(m)}else if(s==="node_mp4"){const _=`ws://${window.location.hostname}:${Ae}`;let T;try{T=new WebSocket(_),T.onopen=function(){n&&n(.1),T.send(JSON.stringify({type:"init",metadata:{framerate:t,codec:i,totalFrames:f.length}}))},T.onmessage=async function(m){const p=JSON.parse(m.data);switch(p.type){case"init":n&&n(.15),await E(T,f);break;case"frame_received":if(n){const I=.15+(p.index+1)/f.length*.7;n(I)}p.index===f.length-1&&T.send(JSON.stringify({type:"render",framerate:t,codec:i}));break;case"render_started":n&&n(.85);break;case"progress":if(n){const I=.85+p.frame/p.totalFrames*.13;n(Math.min(I,.98))}break;case"completed":n&&n(.98);const y=`http://${window.location.hostname}:${Ae}${p.downloadUrl}`,b=document.createElement("a");b.href=y,b.download=a,document.body.appendChild(b),b.click(),document.body.removeChild(b),n&&n(1),T.close();break;case"error":throw console.error("Server error:",p.message),new Error(`Server error: ${p.message}`)}},T.onerror=function(m){throw console.error("WebSocket error:",m),new Error("WebSocket connection error")},await new Promise((m,p)=>{T.onclose=m,T.onerror=p})}catch(m){throw console.error("Error in node_mp4 rendering:",m),T&&T.readyState===WebSocket.OPEN&&T.close(),m}}else{const _=window.JSZip;if(!_)throw new Error("JSZip library is not loaded. Please include JSZip in your project.");const T=new _;for(let b=0;b<f.length;b++)T.file(v[b],f[b]);const m=await T.generateAsync({type:"blob"}),p=URL.createObjectURL(m),y=document.createElement("a");y.href=p,y.download=a.replace(/\.\w+$/,"")+".zip",document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(p)}async function E(_,T){for(let m=0;m<T.length;m++){for(;_.bufferedAmount>1024*1024;)await new Promise(y=>setTimeout(y,100));const p=await T[m].arrayBuffer();_.send(p),m%10===0&&await new Promise(y=>setTimeout(y,10))}}d&&r.play(),n&&n(1)}class Qe{constructor(){h(this,"scene");h(this,"playPauseButton",null);h(this,"scrubber",null);h(this,"timeDisplay",null);h(this,"renderButton",null);h(this,"renderDropdown",null);h(this,"renderOptions",null);h(this,"dropdownToggle",null);h(this,"selectedFormat","mp4");h(this,"progressContainer",null);h(this,"progressBar",null);h(this,"isPlaying",!0);h(this,"isDragging",!1);h(this,"wasPlayingBeforeDrag",!1);h(this,"isRendering",!1);h(this,"updateScrubber",()=>{if(!this.isDragging&&this.scrubber&&this.scene){const e=this.scene.getCurrentTime(),t=this.scene.getDuration();if(t>0){const i=Math.min(Math.floor(e/t*1e3),1e3);this.scrubber.value=i.toString(),this.updateTimeDisplay(e,t),e>=t&&this.isPlaying&&(this.isPlaying=!1,this.playPauseButton&&(this.playPauseButton.textContent="â–¶ï¸"))}}requestAnimationFrame(this.updateScrubber)})}setScene(e){this.scene=e}setZoom(e,t){e.setZoom(t)}setPan(e,t){e.setPan(t)}getZoom(e){return e.zoom}getPan(e){return e.pan}async initialize(e){if(!this.scene)throw Error("Can't initialize without a scene.");if(this.setupControls(e),this.scene){await this.scene.runSequence();const t=this.scene.getDuration(),i=this.scene.getCurrentTime();this.updateTimeDisplay(i,t),this.isPlaying=this.scene.playing(),this.playPauseButton&&(this.playPauseButton.textContent=this.isPlaying?"â¸ï¸":"â–¶ï¸")}this.updateScrubber(),window.mation=this,window.render=async(t="mp4")=>{this.scene?await Oe(this.scene,{outputFormat:t}):console.error("No scene available to render")}}setupControls(e){const t=document.createElement("div");t.className="animation-controls",e.appendChild(t),this.playPauseButton=document.createElement("button"),this.playPauseButton.className="play-pause-button",this.playPauseButton.textContent="â¸ï¸",t.appendChild(this.playPauseButton);const i=document.createElement("button");i.className="reset-zoom-button",i.textContent="ðŸ”",i.title="Reset Zoom",e.appendChild(i);const a=document.createElement("div");a.className="scrubber-container",t.appendChild(a),this.timeDisplay=document.createElement("div"),this.timeDisplay.className="time-display",this.timeDisplay.textContent="0.00 / 0.00",a.appendChild(this.timeDisplay),this.scrubber=document.createElement("input"),this.scrubber.type="range",this.scrubber.min="0",this.scrubber.max="1000",this.scrubber.value="0",this.scrubber.className="scrubber",a.appendChild(this.scrubber),this.renderDropdown=document.createElement("div"),this.renderDropdown.className="render-dropdown",e.appendChild(this.renderDropdown);const n=document.createElement("div");n.className="button-container",this.renderDropdown.appendChild(n),this.renderButton=document.createElement("button"),this.renderButton.className="render-button",this.renderButton.textContent="Render MP4",n.appendChild(this.renderButton),this.dropdownToggle=document.createElement("button"),this.dropdownToggle.className="dropdown-toggle",this.dropdownToggle.innerHTML="â–¼",n.appendChild(this.dropdownToggle),this.renderOptions=document.createElement("div"),this.renderOptions.className="render-options",this.renderDropdown.appendChild(this.renderOptions);const s=Ze(),o=document.createElement("div");o.className="render-option selected",o.textContent="MP4 Video",o.dataset.format="mp4",this.renderOptions.appendChild(o);const l=document.createElement("div");if(l.className="render-option",l.textContent="PNG Sequence (ZIP)",l.dataset.format="zip",this.renderOptions.appendChild(l),s.includes("node_mp4")){const u=document.createElement("div");u.className="render-option",u.textContent="Server MP4 (faster)",u.dataset.format="node_mp4",this.renderOptions.appendChild(u)}this.progressContainer=document.createElement("div"),this.progressContainer.className="progress-container",e.appendChild(this.progressContainer),this.progressBar=document.createElement("div"),this.progressBar.className="progress-bar",this.progressContainer.appendChild(this.progressBar),this.setupEventListeners()}setupEventListeners(){var u,d,c,f,v,E,_,T,m,p,y,b,I,O,w,L,U,N,R,S,F;(u=this.playPauseButton)==null||u.addEventListener("click",()=>{this.scene&&(this.isPlaying?(this.scene.pause(),this.playPauseButton&&(this.playPauseButton.textContent="â–¶ï¸")):(this.scene.getCurrentTime()>=this.scene.getDuration()&&this.scene.seekToTime(0),this.scene.play(),this.playPauseButton&&(this.playPauseButton.textContent="â¸ï¸")),this.isPlaying=!this.isPlaying)});const e=document.querySelector(".reset-zoom-button");e==null||e.addEventListener("click",()=>{if(!this.scene)return;const g=this.scene.canvas.width,P=this.scene.canvas.height;this.scene.setMousePosition(g/2,P/2),this.scene.setZoom(1),this.scene.setPan([0,0])}),(d=this.scrubber)==null||d.addEventListener("mousedown",()=>{this.scene&&(this.isDragging=!0,this.wasPlayingBeforeDrag=this.isPlaying,this.scene.pause(),this.scene.setForceDefaultLayerOnly(!0))}),(c=this.scrubber)==null||c.addEventListener("touchstart",()=>{this.scene&&(this.isDragging=!0,this.wasPlayingBeforeDrag=this.isPlaying,this.scene.pause(),this.scene.setForceDefaultLayerOnly(!0))}),document.addEventListener("mouseup",()=>{this.scene&&this.isDragging&&(this.isDragging=!1,this.scene.setForceDefaultLayerOnly(!1),this.wasPlayingBeforeDrag&&(this.scene.play(),this.isPlaying=!0,this.playPauseButton&&(this.playPauseButton.textContent="â¸ï¸")))}),document.addEventListener("touchend",()=>{this.scene&&this.isDragging&&(this.isDragging=!1,this.scene.setForceDefaultLayerOnly(!1),this.wasPlayingBeforeDrag&&(this.scene.play(),this.isPlaying=!0,this.playPauseButton&&(this.playPauseButton.textContent="â¸ï¸")))}),(f=this.scrubber)==null||f.addEventListener("input",()=>{if(!this.scene||!this.scrubber)return;const g=parseInt(this.scrubber.value,10),P=this.scene.getDuration(),D=g/1e3*P;this.scene.seekToTime(D),this.updateTimeDisplay(D,P)}),(E=(v=this.scene)==null?void 0:v.canvas)==null||E.addEventListener("mousemove",g=>{if(!this.scene||!this.scene.canvas)return;const P=this.scene.canvas.getBoundingClientRect(),D=g.clientX-P.left,$=g.clientY-P.top;this.scene.setMousePosition(D,$)}),(T=(_=this.scene)==null?void 0:_.canvas)==null||T.addEventListener("wheel",g=>{if(!this.scene)return;g.preventDefault();const P=this.scene.canvas.getBoundingClientRect(),D=g.clientX-P.left,$=g.clientY-P.top;this.scene.setMousePosition(D,$);const M=this.scene.zoom;let B;g.deltaY>0?B=Math.max(.05,M/1.1):B=Math.min(10,M*1.1),this.scene.setZoom(B)},{passive:!1});let t=!1,i=0,a=0;(p=(m=this.scene)==null?void 0:m.canvas)==null||p.addEventListener("mousedown",g=>{this.scene&&g.altKey&&(t=!0,i=g.clientX,a=g.clientY)}),(b=(y=this.scene)==null?void 0:y.canvas)==null||b.addEventListener("mousemove",g=>{if(!this.scene||!t)return;const P=g.clientX-i,D=g.clientY-a,[$,M]=this.scene.pan;this.scene.setPan([$+P,M+D]),i=g.clientX,a=g.clientY}),(O=(I=this.scene)==null?void 0:I.canvas)==null||O.addEventListener("mouseup",()=>{t=!1});let n=0,s=1,o=0,l=0;(L=(w=this.scene)==null?void 0:w.canvas)==null||L.addEventListener("touchstart",g=>{if(this.scene&&g.touches.length===2){const P=g.touches[0],D=g.touches[1];n=Math.hypot(D.clientX-P.clientX,D.clientY-P.clientY),s=this.scene.zoom,o=(P.clientX+D.clientX)/2,l=(P.clientY+D.clientY)/2}}),(N=(U=this.scene)==null?void 0:U.canvas)==null||N.addEventListener("touchmove",g=>{if(this.scene&&g.touches.length===2){g.preventDefault();const P=g.touches[0],D=g.touches[1],$=Math.hypot(D.clientX-P.clientX,D.clientY-P.clientY),M=(P.clientX+D.clientX)/2,B=(P.clientY+D.clientY)/2,H=this.scene.canvas.getBoundingClientRect(),$e=M-H.left,ze=B-H.top;this.scene.setMousePosition($e,ze);const ke=$/n;this.scene.setZoom(s*ke);const We=M-o,Xe=B-l,[je,Ve]=this.scene.pan;this.scene.setPan([je+We,Ve+Xe]),o=M,l=B}},{passive:!1}),(R=this.dropdownToggle)==null||R.addEventListener("click",()=>{this.isRendering||this.renderOptions&&this.renderOptions.classList.toggle("visible")}),(S=this.renderOptions)==null||S.addEventListener("click",g=>{var D,$;const P=g.target;if(P.classList.contains("render-option")){const M=P.dataset.format;this.selectedFormat=M;const B=(D=this.renderOptions)==null?void 0:D.querySelectorAll(".render-option");B==null||B.forEach(H=>H.classList.remove("selected")),P.classList.add("selected"),this.renderButton&&(M==="mp4"?this.renderButton.textContent="Render MP4":M==="zip"?this.renderButton.textContent="Render PNGs":M==="node_mp4"&&(this.renderButton.textContent="Render Server MP4")),($=this.renderOptions)==null||$.classList.remove("visible")}}),document.addEventListener("click",g=>{var P;(P=this.renderOptions)!=null&&P.classList.contains("visible")&&this.dropdownToggle&&!(g.target===this.dropdownToggle||this.dropdownToggle.contains(g.target))&&!(g.target===this.renderOptions||this.renderOptions.contains(g.target))&&this.renderOptions.classList.remove("visible")}),(F=this.renderButton)==null||F.addEventListener("click",async()=>{var g;if(!(!this.scene||this.isRendering||!this.renderButton||!this.progressContainer||!this.progressBar)){(g=this.renderOptions)!=null&&g.classList.contains("visible")&&this.renderOptions.classList.remove("visible"),this.isRendering=!0,this.renderButton.disabled=!0,this.renderButton.textContent="Rendering...",this.progressContainer.classList.add("visible"),this.progressBar.style.width="0%";try{await Oe(this.scene,{onProgress:P=>{this.progressBar&&(this.progressBar.style.width=`${P*100}%`)},outputFormat:this.selectedFormat}),this.renderButton&&(this.renderButton.textContent="Render Complete!"),setTimeout(()=>{this.renderButton&&(this.selectedFormat==="mp4"?this.renderButton.textContent="Render MP4":this.selectedFormat==="zip"?this.renderButton.textContent="Render PNGs":this.selectedFormat==="node_mp4"&&(this.renderButton.textContent="Render Server MP4"),this.renderButton.disabled=!1),this.progressContainer&&this.progressContainer.classList.remove("visible")},3e3)}catch(P){console.error("Rendering failed:",P),this.renderButton&&(this.renderButton.textContent="Render Failed"),setTimeout(()=>{this.renderButton&&(this.selectedFormat==="mp4"?this.renderButton.textContent="Render MP4":this.selectedFormat==="zip"?this.renderButton.textContent="Render PNGs":this.selectedFormat==="node_mp4"&&(this.renderButton.textContent="Render Server MP4"),this.renderButton.disabled=!1),this.progressContainer&&this.progressContainer.classList.remove("visible")},3e3)}this.isRendering=!1}})}updateTimeDisplay(e,t){this.timeDisplay&&(this.timeDisplay.textContent=`${e.toFixed(2)}s / ${t.toFixed(2)}s`)}}const ne=`#version 300 es
precision highp float;
precision highp int;
`,He=`in vec2 position;
out vec2 vUv;
void main() {
    vUv = 0.5 * (position + 1.0);
    gl_Position = vec4(position, 0.0, 1.0);
}`;class Ke{constructor(e,t,i){h(this,"vertexShader");h(this,"fragmentShader");h(this,"program");h(this,"quad");h(this,"name");h(this,"w");h(this,"uniforms");const{fragmentShader:a,vertexShader:n,uniforms:s,name:o}=i;this.vertexShader=n??He,this.fragmentShader=a,this.program=e.createProgram(`${ne}${this.vertexShader}`,`${ne}${this.fragmentShader}`),this.uniforms=s,this.quad=t,this.name=o||"",e.programs.set(o||"",this.program),this.w=e}updateFragmentShader(e){this.fragmentShader=e,this.program=this.w.createProgram(this.vertexShader,`${ne}${this.fragmentShader}`),this.w.programs.set(this.name,this.program)}set(e){Object.keys(e).forEach(t=>{this.uniforms[t]=e[t]})}render(e){e!=null&&e.uniforms&&this.set(e.uniforms),typeof(e==null?void 0:e.renderTarget)<"u"?this.w.setRenderTarget(e.renderTarget):this.w.setRenderTarget(null),this.w.render(this.name,this.uniforms,{position:this.quad})}}class Je{constructor(e,t){h(this,"w");h(this,"quad");h(this,"passes");this.w=e,this.quad=t,this.passes={}}add(e,t={},i={}){const a=i.dpr||window.devicePixelRatio||1,n=i.scale?a:1,s=this.w,o=this.w.canvas,l=this.w.canvas.width,u=this.w.canvas.height;s.gl.viewport(0,0,o.width,o.height);const d={minFilter:s.gl.NEAREST,magFilter:s.gl.NEAREST,internalFormat:s.gl.RGBA16F,format:s.gl.RGBA,type:s.gl.HALF_FLOAT,...t},c=(i==null?void 0:i.renderTargetCount)??2,f=[];for(let E=0;E<c;E++)f.push(s.createRenderTarget(l*n,u*n,d));const v=this.createPass(e);return{canvas:o,render:E=>{v.render({uniforms:E==null?void 0:E.uniforms,renderTarget:E==null?void 0:E.renderTarget})},renderTargets:f,renderer:s,scaling:a,uniforms:v.uniforms,gl:this.gl(),stage:v}}createPass(e){const{name:t}=e,i=`pass-${Object.keys(this.passes).length}:-${t??""}`,a=new Ke(this.w,this.quad,{...e,name:i});return this.passes[i]=a,a}gl(){return this.w.gl}}class et{constructor(e,t,i,a){h(this,"gl");h(this,"name");h(this,"texture");h(this,"framebuffer");this.gl=e,this.name=t,this.texture=i,this.framebuffer=a}updateFilters({minFilter:e,magFilter:t}){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,t),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}}class tt{constructor(e,t){h(this,"canvas");h(this,"gl");h(this,"programs");h(this,"framebuffers");h(this,"defaultRenderTargetProps");h(this,"renderTargets");this.canvas=e;const i=(t==null?void 0:t.dpr)??(window.devicePixelRatio||1),a=(t==null?void 0:t.canvasScale)??1/i,n=e.width,s=e.height;"style"in e&&(e.style.width=`${n*a}px`,e.style.height=`${s*a}px`);const o=e.getContext("webgl2",{antialiasing:!1,alpha:!1});if(!o)throw new Error("WebGL2 not supported");this.gl=o,this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("EXT_color_buffer_half_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.BLEND),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.clearDepth(1),this.gl.colorMask(!0,!0,!0,!0),this.programs=new Map,this.framebuffers=new Map,this.defaultRenderTargetProps={minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,internalFormat:this.gl.RGBA16F,format:this.gl.RGBA,type:this.gl.HALF_FLOAT},this.renderTargets={}}createProgram(e,t){const i=this.createShader(this.gl.VERTEX_SHADER,e),a=this.createShader(this.gl.FRAGMENT_SHADER,t),n=this.gl.createProgram();if(!n)throw new Error("Failed to create WebGL program");if(this.gl.attachShader(n,i),this.gl.attachShader(n,a),this.gl.linkProgram(n),!this.gl.getProgramParameter(n,this.gl.LINK_STATUS))throw new Error("Unable to initialize the shader program: "+this.gl.getProgramInfoLog(n));return n}addLineNumbers(e){return e.split(`
`).map((t,i)=>`${i+1}: ${t}`).join(`
`)}createShader(e,t){const i=this.gl.createShader(e);if(!i)throw new Error("Failed to create WebGL shader");if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error("An error occurred compiling the shaders: "+this.gl.getShaderInfoLog(i)+`
${this.addLineNumbers(t)}`);return i}createTextureFromImage(e,t){const a=this.gl.createTexture();if(!a)throw new Error("Failed to create WebGL texture");const n=new Image;n.src=e;const s=this;return n.onload=function(){const o=document.createElement("canvas");o.width=n.width,o.height=n.height;const l=o.getContext("2d");if(!l)throw new Error("Failed to get 2D context");l.drawImage(n,0,n.height),s.createTextureFromCanvas(o),t&&t()},a}createTextureFromCanvas(e){const t=this.gl,i=t.createTexture();if(!i)throw new Error("Failed to create WebGL texture");if(!e.getContext("2d"))throw new Error("Failed to get 2D context");return t.bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,null),i}createRenderTarget(e,t,i={},a){const{minFilter:n,magFilter:s,internalFormat:o,format:l,type:u}={...this.defaultRenderTargetProps,...i},d=a??`rt-${Object.keys(this.renderTargets).length}`,c=this.gl.createFramebuffer();if(!c)throw new Error("Failed to create framebuffer");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,c);const f=this.gl.createTexture();if(!f)throw new Error("Failed to create texture");this.gl.bindTexture(this.gl.TEXTURE_2D,f),this.gl.texImage2D(this.gl.TEXTURE_2D,0,o,e,t,0,l,u,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,n),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,s),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f,0);const v=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(v!==this.gl.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete: "+v);return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.framebuffers.set(d,{framebuffer:c,texture:f,width:e,height:t}),this.renderTargets[d]=new et(this.gl,d,f,c),this.renderTargets[d]}setRenderTargetInternal(e){if(e===null)this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);else{const t=this.framebuffers.get(e);if(!t)throw new Error(`Render target "${e}" not found`);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer),this.gl.viewport(0,0,t.width,t.height)}}setRenderTarget(e){return this.setRenderTargetInternal((e==null?void 0:e.name)??null)}clear(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)}getRenderTargetTexture(e){const t=this.framebuffers.get(e);if(!t)throw new Error(`Render target "${e}" not found`);return t.texture}setUniform(e,t,i,a,n,s){const o=e.getUniformLocation(a,n);if(o===null)return;let l=null;for(let f=0;f<i;f++){const v=e.getActiveUniform(a,f);if(v&&v.name===n){l=v;break}}if(!l){console.warn(`Unable to find uniform info for "${n}"`);return}const{type:u,size:d}=l;function c(f,v){return f instanceof v?f:new v(f)}switch(u){case e.FLOAT:e.uniform1f(o,s);break;case e.INT:case e.BOOL:e.uniform1i(o,s);break;case e.FLOAT_VEC2:e.uniform2fv(o,c(s,Float32Array));break;case e.FLOAT_VEC3:e.uniform3fv(o,c(s,Float32Array));break;case e.FLOAT_VEC4:e.uniform4fv(o,c(s,Float32Array));break;case e.INT_VEC2:case e.BOOL_VEC2:e.uniform2iv(o,c(s,Int32Array));break;case e.INT_VEC3:case e.BOOL_VEC3:e.uniform3iv(o,c(s,Int32Array));break;case e.INT_VEC4:case e.BOOL_VEC4:e.uniform4iv(o,c(s,Int32Array));break;case e.FLOAT_MAT2:e.uniformMatrix2fv(o,!1,c(s,Float32Array));break;case e.FLOAT_MAT3:e.uniformMatrix3fv(o,!1,c(s,Float32Array));break;case e.FLOAT_MAT4:e.uniformMatrix4fv(o,!1,c(s,Float32Array));break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:const f=t.length;this.gl.activeTexture(this.gl.TEXTURE0+f),t.push(f),this.gl.bindTexture(this.gl.TEXTURE_2D,s),this.gl.uniform1i(o,f),s!=null&&this.gl.generateMipmap(this.gl.TEXTURE_2D);break;default:u===e.FLOAT&&d>1?e.uniform1fv(o,c(s,Float32Array)):(u===e.INT||u===e.BOOL)&&d>1?e.uniform1iv(o,c(s,Int32Array)):console.warn(`Unsupported uniform type: ${u}`);break}}render(e,t={},i={}){const a=this.programs.get(e);if(!a)throw new Error(`Program "${e}" not found`);this.gl.useProgram(a);const n=[],s=this.gl.getProgramParameter(a,this.gl.ACTIVE_UNIFORMS);for(const[o,l]of Object.entries(t))this.setUniform(this.gl,n,s,a,o,l);for(const[o,l]of Object.entries(i)){const u=this.gl.getAttribLocation(a,o);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.buffer),this.gl.enableVertexAttribArray(u),this.gl.vertexAttribPointer(u,l.size,this.gl.FLOAT,!1,0,0)}this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}createFullscreenQuad(){const e=this.gl.createBuffer();if(!e)throw new Error("Failed to create buffer");return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.gl.STATIC_DRAW),{buffer:e,size:2}}createPipeline(){const e=this.createFullscreenQuad();return new Je(this,e)}cleanup(){this.clear()}}function ue(r){return new tt(r).createPipeline()}class Q{constructor(e,t,i,a={}){h(this,"name");h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"isSubview");h(this,"renderWhenScrubbing");h(this,"extras");h(this,"pipeline");h(this,"ignorePanZoom");h(this,"render");this.name=e,this.pipeline=t,this.render=i,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.isSubview=a.isSubview,this.renderWhenScrubbing=a.renderWhenScrubbing,this.ignorePanZoom=a.ignorePanZoom,this.extras=a.extras}cleanup(){this.pipeline.w.cleanup()}}const rt={fragmentShader:`in vec2 vUv;
out vec4 fragColor;
uniform sampler2D u_texture;
uniform float u_progress;

void main() {
  fragColor = texture(u_texture, vUv);
}`,uniforms:{u_texture:null,u_progress:0}},Y=class Y{constructor({canvas:e,width:t,height:i}){h(this,"canvas");h(this,"ctx");h(this,"width");h(this,"height");h(this,"_zoom",1);h(this,"_pan",[0,0]);h(this,"mousePosition",[0,0]);h(this,"animationId",null);h(this,"texturePipelineResult");h(this,"layers",[]);h(this,"layerLookup",{});h(this,"layerInitialProperties",{});h(this,"layerCanvases",{});h(this,"layerElements",{});h(this,"defaultLayerElements",[]);h(this,"defaultLayerCanvas");h(this,"onFrame");h(this,"textureCache",{});h(this,"animationSegments",[]);h(this,"isPlaying",!0);h(this,"currentTime",0);h(this,"totalDuration",0);h(this,"lastRenderTime",0);h(this,"forceDefaultLayerOnly",!1);this.canvas=e,this.canvas.width=t,this.canvas.height=i,this.width=t,this.height=i;const{ctx:a,texturePipelineResult:n,defaultLayerCanvas:s}=this.initialize();this.ctx=a,this.texturePipelineResult=n,this.defaultLayerCanvas=s}get zoom(){return this._zoom}set zoom(e){this._zoom=e,this.savePlayerState()}get pan(){return this._pan}set pan(e){this._pan=e,this.savePlayerState()}setMousePosition(e,t){this.mousePosition=[e*window.devicePixelRatio,t*window.devicePixelRatio]}setZoom(e){const[t,i]=this.mousePosition,a=(t-this._pan[0])/this._zoom,n=(i-this._pan[1])/this._zoom;this._zoom=e;const s=t-a*this._zoom,o=i-n*this._zoom;this._pan[0]=s,this._pan[1]=o,this.setForceDefaultLayerOnly(!0),this.clear(),this.setForceDefaultLayerOnly(!1),this.savePlayerState()}setPan(e){this._pan=e,this.setForceDefaultLayerOnly(!0),this.clear(),this.setForceDefaultLayerOnly(!1),this.savePlayerState()}initialize(){const e=new OffscreenCanvas(this.width,this.height);e.width=this.width,e.height=this.height;const t=e.getContext("2d");if(!t)throw new Error("Failed to get 2D context");this.ctx=t;const i=ue(this.canvas);return this.texturePipelineResult=i.add(rt),this.defaultLayerCanvas=new OffscreenCanvas(this.canvas.width,this.canvas.height),this.setupLayers(),this.restorePlayerState(),{ctx:t,texturePipelineResult:this.texturePipelineResult,defaultLayerCanvas:this.defaultLayerCanvas}}insertLayer(e,t){this.layerInitialProperties[t.name]={x:t.x,y:t.y,width:t.width,height:t.height,isSubview:t.isSubview,renderWhenScrubbing:t.renderWhenScrubbing,extras:t.extras?{...t.extras}:void 0},this.layerLookup[t.name]=t,this.layers.splice(e,0,t),this.layerElements[t.name]=[];const i=t.width??this.canvas.width,a=t.height??this.canvas.height;this.layerCanvases[t.name]=new OffscreenCanvas(i,a)}pushLayer(e){this.layerInitialProperties[e.name]={x:e.x,y:e.y,width:e.width,height:e.height,isSubview:e.isSubview,renderWhenScrubbing:e.renderWhenScrubbing,extras:e.extras?{...e.extras}:void 0},this.layerLookup[e.name]=e,this.layers.push(e),this.layerElements[e.name]=[],this.layerCanvases[e.name]=new OffscreenCanvas(this.canvas.width,this.canvas.height)}getLayer(e){return this.layerLookup[e]}registerElement(e){if(e.layer)if(Array.isArray(e.layer))for(const t of e.layer)this.layerLookup[t]&&this.layerElements[t].push(e);else this.layerLookup[e.layer]?this.layerElements[e.layer].push(e):this.defaultLayerElements.push(e);else this.defaultLayerElements.push(e)}clear(){this.texturePipelineResult.renderer.cleanup(),this.layers.forEach(t=>{t.cleanup()}),this.defaultLayerCanvas.getContext("2d").clearRect(0,0,this.defaultLayerCanvas.width,this.defaultLayerCanvas.height);for(const t in this.layerCanvases)this.layerCanvases[t].getContext("2d").clearRect(0,0,this.layerCanvases[t].width,this.layerCanvases[t].height)}getTextureForCanvas(e){const t=e===this.defaultLayerCanvas?"default":e.toString();if(!this.textureCache[t])this.textureCache[t]=this.texturePipelineResult.renderer.createTextureFromCanvas(e);else{const i=this.texturePipelineResult.gl;i.bindTexture(i.TEXTURE_2D,this.textureCache[t]),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1)}return this.textureCache[t]}reset(){this.clear(),this.animationSegments=[],this.defaultLayerElements=[];for(const t in this.layerElements){const i=this.layerLookup[t];i&&i.cleanup(),this.layerElements[t]=[]}this.currentTime=0,this.totalDuration=0;const e=this.texturePipelineResult.gl;for(const t in this.textureCache)e.deleteTexture(this.textureCache[t]);this.textureCache={},this.clearPlayerState()}savePlayerState(){const e={currentTime:this.currentTime,isPlaying:this.isPlaying,totalDuration:this.totalDuration,zoom:this._zoom,pan:this._pan};try{localStorage.setItem(Y.PLAYER_STATE_KEY,JSON.stringify(e))}catch(t){console.warn("Failed to save player state:",t)}}restorePlayerState(){try{const e=localStorage.getItem(Y.PLAYER_STATE_KEY);if(e){const t=JSON.parse(e);console.log("Found saved state:",t),t.isPlaying!==void 0&&(this.isPlaying=t.isPlaying,console.log(`Restored playing state: ${this.isPlaying}`)),t.currentTime!==void 0&&(this.currentTime=t.currentTime,console.log(`Stored time for later restoration: ${this.currentTime}`)),t.zoom!==void 0&&(this._zoom=t.zoom,console.log(`Restored zoom: ${this._zoom}`)),t.pan!==void 0&&(this._pan=t.pan,console.log(`Restored pan: ${this._pan}`))}else console.log("No saved player state found")}catch(e){console.warn("Failed to restore player state:",e)}}clearPlayerState(){try{localStorage.removeItem(Y.PLAYER_STATE_KEY)}catch(e){console.warn("Failed to clear player state:",e)}}apply(e){e(this.ctx)}setupLayers(){}*animationSequence(){}async runSequence(){this.clear();const e=this.totalDuration,t=this.currentTime,i=this.isPlaying,a=this.currentTime;if(this.currentTime=0,this.totalDuration=0,this.animationSegments=[],this.lastRenderTime=0,await this.buildAnimationTimeline(),t>0||a>0){const n=Math.max(t,a);e!==this.totalDuration&&n>this.totalDuration?this.currentTime=n>=e?this.totalDuration:0:this.currentTime=Math.min(n,this.totalDuration)}return this.isPlaying=i,this.renderAtTime(this.currentTime),this.isPlaying&&(this.lastRenderTime=performance.now(),this.startAnimationLoop()),this.savePlayerState(),Promise.resolve()}async buildAnimationTimeline(){this.ctx.save();const e=this.animationSequence();let t=e.next();for(;!t.done;)await t.value,t=e.next();this.ctx.restore(),console.log(`Animation timeline built with ${this.animationSegments.length} segments, total duration: ${this.totalDuration}s`)}play(){this.isPlaying||(this.currentTime>=this.totalDuration&&(this.currentTime=0),this.isPlaying=!0,this.lastRenderTime=performance.now(),this.startAnimationLoop(),this.savePlayerState())}pause(){this.isPlaying&&(this.isPlaying=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.savePlayerState())}playing(){return this.isPlaying}togglePlayPause(){this.isPlaying?this.pause():this.play()}getDuration(){return this.totalDuration}getCurrentTime(){return this.currentTime}startAnimationLoop(){this.animationId&&cancelAnimationFrame(this.animationId);const e=t=>{if(!this.isPlaying)return;const i=(t-this.lastRenderTime)/1e3;this.lastRenderTime=t;const a=this.currentTime;if(this.currentTime=Math.min(this.currentTime+i,this.totalDuration),this.renderAtTime(this.currentTime),this.savePlayerState(),this.onFrame&&this.onFrame(),this.currentTime>=this.totalDuration){this.isPlaying=!1,a<this.totalDuration&&this.renderAtTime(this.totalDuration),this.savePlayerState();return}this.animationId=requestAnimationFrame(e)};this.lastRenderTime=performance.now(),this.animationId=requestAnimationFrame(e)}renderAtTime(e){const t=Math.max(0,Math.min(e,this.totalDuration));this.currentTime=t,this.clear();const i=this.animationSegments.filter(n=>n.startTime<=t);i.sort((n,s)=>n.startTime-s.startTime);const a=new Map;for(const n of i){const s=t-n.startTime;let o;s>=n.duration?o=1:(o=Math.max(0,Math.min(s/n.duration,1)),o=n.easing(o));for(const l of n.elements)a.set(l,o)}this.renderFrame(a)}seekToTime(e){const t=Math.max(0,Math.min(e,this.totalDuration));this.currentTime=t,this.lastRenderTime=performance.now(),this.renderAtTime(t),t>=this.totalDuration&&(this.isPlaying=!1),this.savePlayerState()}setForceDefaultLayerOnly(e){this.forceDefaultLayerOnly!==e&&(this.forceDefaultLayerOnly=e,this.forceDefaultLayerOnly||this.renderAtTime(this.currentTime))}getForceDefaultLayerOnly(){return this.forceDefaultLayerOnly}animate(e,t){const i=this.currentTime,a=t.delay||0,n=i+a,s=t.duration;for(const l of e)l.segmentStartTime=n,this.registerElement(l);const o={startTime:n,duration:s,elements:[...e],easing:t.easing||(l=>l)};this.animationSegments.push(o),this.totalDuration=Math.max(this.totalDuration,n+s),t!=null&&t.parallel||(this.currentTime=n+s)}renderElement(e,t,i){e.update&&e.update(i),e.draw(t,i,{layers:this.layerLookup})}renderFrame(e){const t=this.currentTime,i=this.defaultLayerCanvas.getContext("2d");i.clearRect(0,0,this.defaultLayerCanvas.width,this.defaultLayerCanvas.height),i.save(),i.translate(this.pan[0],this.pan[1]),i.scale(this.zoom,this.zoom),Object.keys(this.layerInitialProperties).forEach(s=>{const o=this.layerInitialProperties[s];if(o){const l=this.layerLookup[s];Object.assign(l,o)}});for(const s of this.defaultLayerElements){if(s.segmentStartTime!==void 0&&s.segmentStartTime>t)continue;const o=e.has(s)?e.get(s):1;this.renderElement(s,i,o)}for(const s in this.layerElements){const o=this.layerLookup[s];if(this.forceDefaultLayerOnly&&!o.renderWhenScrubbing){const l=this.layerElements[s];for(const u of l){if(u.segmentStartTime!==void 0&&u.segmentStartTime>t)continue;const d=e.has(u)?e.get(u):1;this.renderElement(u,i,d)}}}const a=this.getTextureForCanvas(this.defaultLayerCanvas);this.texturePipelineResult.stage.set({u_texture:a,u_progress:1}),this.texturePipelineResult.renderer.setRenderTarget(null);const n=this.texturePipelineResult.gl;n.disable(n.SCISSOR_TEST),this.texturePipelineResult.render();for(const s of this.layers)if(!this.forceDefaultLayerOnly||s.renderWhenScrubbing){const o=this.layerCanvases[s.name],l=o.getContext("2d");l.clearRect(0,0,o.width,o.height),l.save();const u=this.zoom,d=this.pan,c=(s.x??0)*u+d[0],f=(s.y??0)*u+d[1],v=(s.width??o.width)*u,E=(s.height??o.height)*u;if(s.isSubview)l.translate(d[0],d[1]),l.scale(u,u);else{const p=v/this.canvas.width,y=E/this.canvas.height;l.translate(c,f),l.scale(p,y)}const _=this.layerElements[s.name];for(const p of _){if(p.segmentStartTime!==void 0&&p.segmentStartTime>t)continue;const y=e.has(p)?e.get(p):1;this.renderElement(p,l,y)}l.restore();const T=this.getTextureForCanvas(o),m=this.texturePipelineResult.gl;m.enable(m.BLEND),m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA),m.enable(m.SCISSOR_TEST),s.ignorePanZoom?m.scissor(s.x??0,s.y??0,s.width??o.width,s.height??o.height):m.scissor(c,this.canvas.height-f-E,v,E),s.render(T,1),m.disable(m.BLEND),m.disable(m.SCISSOR_TEST)}i.restore()}};h(Y,"PLAYER_STATE_KEY","mation_player_state");let ce=Y;var de={},fe={},ee={},me={},A={};Object.defineProperty(A,"__esModule",{value:!0});A._=void 0;A.SPACE=" ";A.FILL="fill";A.NONE="none";A.DRAW_LINE_VERTICAL="V";A.DRAW_LINE_HORIZONTAL="H";A.DRAW_LINE="L";A.CLOSE_PATH="Z";A.MOVE_CURSOR="M";A.DRAW_CURVE_CUBIC_BEZIER="C";A.DRAW_CURVE_SMOOTH="S";A.DRAW_CURVE_QUADRATIC="Q";A.DRAW_CURVE_QUADRATIC_CONTINUATION="T";A.DRAW_ARC="A";var ge={};Object.defineProperty(ge,"__esModule",{value:!0});function it(r){return typeof r=="string"}ge.isString=it;var z={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Math;r.abs=e.abs,r.min=e.min,r.max=e.max,r.floor=e.floor,r.round=e.round,r.sqrt=e.sqrt,r.pow=e.pow,r.cos=e.cos,r.asin=e.asin,r.sin=e.sin,r.tan=e.tan,r.PI=e.PI,r.QUADRATIC_RATIO=2/3,r.EPSILON=r.pow(2,-52)})(z);Object.defineProperty(me,"__esModule",{value:!0});var ae=A,st=ge,nt=z;function at(r,e){if(e===void 0&&(e=nt.round),st.isString(r))return r;for(var t=[],i=0;i<r.length;i++){var a=r[i];t.push(ae.MOVE_CURSOR,e(a[0]),e(a[1]),ae.DRAW_CURVE_CUBIC_BEZIER);for(var n=void 0,s=2;s<a.length;s+=6){var o=e(a[s]),l=e(a[s+1]),u=e(a[s+2]),d=e(a[s+3]),c=e(a[s+4]),f=e(a[s+5]),v=o==c&&u==c&&l==f&&d==f;(!v||n!=(n=""+o+l+u+d+c+f))&&t.push(o,l,u,d,c,f)}}return t.join(ae.SPACE)}me.renderPath=at;var q={};Object.defineProperty(q,"__esModule",{value:!0});var ot=A;function lt(){throw new Error(Array.prototype.join.call(arguments,ot.SPACE))}q.raiseError=lt;var ve={},pe={},Z={},Te={};Object.defineProperty(Te,"__esModule",{value:!0});var ut=typeof window<"u"&&window.navigator.userAgent;Te.isEdge=/(MSIE |Trident\/|Edge\/)/i.test(ut);Object.defineProperty(Z,"__esModule",{value:!0});var ct=Te,ht=ct.isEdge?Array:Float32Array;function dt(r){return new ht(r)}Z.createNumberArray=dt;var te={};Object.defineProperty(te,"__esModule",{value:!0});var K=z;function ft(r){for(var e=r[0],t=r[1],i=t,a=e,n=2;n<r.length;n+=6){var s=r[n+4],o=r[n+5];e=K.min(e,s),a=K.max(a,s),t=K.min(t,o),i=K.max(i,o)}return{x:e,w:a-e,y:t,h:i-t}}function mt(r,e,t){var i=ft(t);return{x:i.x+i.w*r,y:i.y+i.h*e}}te.computeAbsoluteOrigin=mt;Object.defineProperty(pe,"__esModule",{value:!0});var gt=Z,vt=te;function Ue(r,e,t){var i=r.length,a=e.length;if(i<a)return Ue(e,r,t);e.length=i;for(var n=a;n<i;n++){var s=r[n],o=t.x,l=t.y;if(!t.absolute){var u=vt.computeAbsoluteOrigin(o,l,s);o=u.x,l=u.y}for(var d=gt.createNumberArray(s.length),c=0;c<s.length;c+=2)d[c]=o,d[c+1]=l;e[n]=d}}pe.fillSegments=Ue;var ye={},_e={};Object.defineProperty(_e,"__esModule",{value:!0});var pt=Z;function Tt(r,e){var t=r.length,i=t-e,a=pt.createNumberArray(e),n;for(n=0;n<e;n++)a[n]=r[n];for(n=e;n<t;n++)r[n-e]=r[n];for(n=0;n<e;n++)r[i+n]=a[n]}_e.rotatePoints=Tt;var re={};Object.defineProperty(re,"__esModule",{value:!0});var yt=z;function _t(r,e,t,i){return yt.sqrt((r-t)*(r-t)+(e-i)*(e-i))}re.distance=_t;Object.defineProperty(ye,"__esModule",{value:!0});var Ct=_e,Pt=A,Et=re,bt=te;function wt(r,e,t,i){var a=i.length;if(!(i[a-2]!==i[0]||i[a-1]!==i[1])){if(!r){var n=bt.computeAbsoluteOrigin(e,t,i);e=n.x,t=n.y}var s=i.slice(2);a=s.length;for(var o,l,u=0;u<a;u+=6){var d=Et.distance(e,e,s[u],s[u+1]);(l===Pt._||d<l)&&(l=d,o=u)}Ct.rotatePoints(s,o),i[0]=s[a-2],i[1]=s[a-1];for(var u=0;u<s.length;u++)i[u+2]=s[u]}}ye.normalizePoints=wt;var ie={};Object.defineProperty(ie,"__esModule",{value:!0});var Rt=z,St=Z;function At(r,e){for(var t=r[0].length,i=0;i<t;i++){var a=r[0][i],n=r[1][i],s=Rt.max(a.length+e,n.length+e);r[0][i]=he(a,s),r[1][i]=he(n,s)}}ie.fillPoints=At;function he(r,e){var t=e-r.length,i=Math.ceil(e/r.length),a=St.createNumberArray(e);a[0]=r[0],a[1]=r[1];for(var n=1,s=1;s<e-1;){a[++s]=r[++n],a[++s]=r[++n],a[++s]=r[++n],a[++s]=r[++n];var o=a[++s]=r[++n],l=a[++s]=r[++n];if(t)for(var u=0;u<i&&t;u++)a[s+5]=a[s+3]=a[s+1]=o,a[s+6]=a[s+4]=a[s+2]=l,s+=6,t-=6}return a}ie.fillSubpath=he;var Ce={},Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});var Ot=z,Lt=re;function Dt(r){for(var e=r.length,t=r[e-2],i=r[e-1],a=0,n=0;n<e;n+=6)a+=Lt.distance(r[n],r[n+1],t,i),t=r[n],i=r[n+1];return Ot.floor(a)}Pe.perimeterPoints=Dt;Object.defineProperty(Ce,"__esModule",{value:!0});var xt=Pe;function Ft(r){return r.map(function(e){return{points:e,perimeter:xt.perimeterPoints(e)}}).sort(function(e,t){return t.perimeter-e.perimeter}).map(function(e){return e.points})}Ce.getSortedSegments=Ft;Object.defineProperty(ve,"__esModule",{value:!0});var It=pe,Le=ye,Ut=ie,oe=A,Mt=q,De=Ce;function Bt(r,e,t){t.optimize===oe.FILL&&(r=De.getSortedSegments(r),e=De.getSortedSegments(e)),r.length!==e.length&&(t.optimize===oe.FILL?It.fillSegments(r,e,t.origin):Mt.raiseError("optimize:none requires equal lengths"));var i=Array(2);if(i[0]=r,i[1]=e,t.optimize===oe.FILL){for(var a=t.origin,n=a.x,s=a.y,o=a.absolute,l=0;l<r.length;l++)Le.normalizePoints(o,n,s,i[0][l]),Le.normalizePoints(o,n,s,i[1][l]);Ut.fillPoints(i,t.addPoints*6)}return i}ve.normalizePaths=Bt;var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});function Nt(r,e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t]);return r}Ee.fillObject=Nt;Object.defineProperty(ee,"__esModule",{value:!0});var $t=me,G=z,zt=q,kt=ve,Wt=Ee,Xt=Z,Me=A,jt={addPoints:0,optimize:Me.FILL,origin:{x:0,y:0},precision:0};function Vt(r,e){e=Wt.fillObject(e,jt),(!r||r.length<2)&&zt.raiseError("invalid arguments");for(var t=r.length-1,i=Array(t),a=0;a<t;a++)i[a]=Gt(r[a],r[a+1],e);var n=e.precision?function(s){return s.toFixed(e.precision)}:Me._;return function(s){var o=t*s,l=G.min(G.floor(o),t-1);return $t.renderPath(i[l]((o-l)/(l+1)),n)}}ee.interpolatePath=Vt;function Gt(r,e,t){var i=kt.normalizePaths(r.getData(),e.getData(),t),a=i[0].length;return function(n){if(G.abs(n-0)<G.EPSILON)return r.getStringData();if(G.abs(n-1)<G.EPSILON)return e.getStringData();for(var s=Array(a),o=0;o<a;o++)s[o]=Be(i[0][o],i[1][o],n);return s}}function Be(r,e,t){for(var i=r.length,a=Xt.createNumberArray(i),n=0;n<i;n++)a[n]=r[n]+(e[n]-r[n])*t;return a}ee.mixPoints=Be;var se={},be={},we={},Re={};Object.defineProperty(Re,"__esModule",{value:!0});var Yt=A;function qt(r,e){return r===Yt._?e:r}Re.coalesce=qt;var Se={};Object.defineProperty(Se,"__esModule",{value:!0});var x=z,xe=x.PI*120/180,J=x.PI*2;function Ne(r,e,t,i,a,n,s,o,l,u,d,c,f){if(t<=0||i<=0)return[r,e,o,l,o,l];var v=x.PI/180*(+a||0),E=x.cos(v),_=x.sin(v),T=!!u;if(!T){var m=r,p=o;r=m*E-e*-_,e=m*-_+e*E,o=p*E-l*-_,l=p*-_+l*E;var y=(r-o)/2,b=(e-l)/2,I=y*y/(t*t)+b*b/(i*i);I>1&&(I=x.sqrt(I),t=I*t,i=I*i);var O=(n===s?-1:1)*x.sqrt(x.abs((t*t*i*i-t*t*b*b-i*i*y*y)/(t*t*b*b+i*i*y*y)));c=O*t*b/i+(r+o)/2,f=O*-i*y/t+(e+l)/2,u=x.asin((e-f)/i),d=x.asin((l-f)/i),r<c&&(u=x.PI-u),o<c&&(d=x.PI-d),u<0&&(u+=J),d<0&&(d+=J),s&&u>d&&(u-=J),!s&&d>u&&(d-=J)}var w;if(x.abs(d-u)>xe){var L=d,U=o,N=l;d=u+xe*(s&&d>u?1:-1),o=c+t*x.cos(d),l=f+i*x.sin(d),w=Ne(o,l,t,i,a,0,s,U,N,d,L,c,f)}else w=[];var R=4/3*x.tan((d-u)/4);if(w.splice(0,0,2*r-(r+R*t*x.sin(u)),2*e-(e-R*i*x.cos(u)),o+R*t*x.sin(d),l-R*i*x.cos(d),o,l),!T)for(var S=0,F=w.length;S<F;S+=2){var g=w[S],P=w[S+1];w[S]=g*E-P*_,w[S+1]=g*_+P*E}return w}Se.arcToCurve=Ne;Object.defineProperty(we,"__esModule",{value:!0});var C=A,j=Re,Zt=q,W=z,Qt=Se,Ht={M:2,H:1,V:1,L:2,Z:0,C:6,S:4,Q:4,T:2,A:7};function k(r,e,t,i,a,n,s){var o=r.x,l=r.y;r.x=j.coalesce(n,o),r.y=j.coalesce(s,l),r.current.push(j.coalesce(e,o),t=j.coalesce(t,l),i=j.coalesce(i,o),a=j.coalesce(a,l),r.x,r.y),r.lc=r.c}function Kt(r){var e=r.c,t=r.t,i=r.x,a=r.y;if(e===C.DRAW_LINE_VERTICAL)t[0]+=a;else if(e===C.DRAW_LINE_HORIZONTAL)t[0]+=i;else if(e===C.DRAW_ARC)t[5]+=i,t[6]+=a;else for(var n=0;n<t.length;n+=2)t[n]+=i,t[n+1]+=a}function Jt(r){return r.replace(/[\^\s]*([mhvlzcsqta]|\-?\d*\.?\d+)[,\$\s]*/gi," $1").replace(/([mhvlzcsqta])/gi," $1").trim().split("  ").map(er)}function er(r){return r.split(C.SPACE).map(tr)}function tr(r,e){return e===0?r:+r}function rr(r){for(var e={x:0,y:0,segments:[]},t=Jt(r),i=0;i<t.length;i++){var a=t[i],n=a[0],s=n.toUpperCase(),o=s!==C.CLOSE_PATH&&s!==n;e.c=s;var l=Ht[s],u=a,d=1;do{e.t=u.length===1?u:u.slice(d,d+l),o&&Kt(e);var c=e.t,f=e.x,v=e.y,E=void 0,_=void 0,T=void 0,m=void 0,p=void 0,y=void 0;if(s===C.MOVE_CURSOR)e.segments.push(e.current=[e.x=c[0],e.y=c[1]]);else if(s===C.DRAW_LINE_HORIZONTAL)k(e,C._,C._,C._,C._,c[0],C._);else if(s===C.DRAW_LINE_VERTICAL)k(e,C._,C._,C._,C._,C._,c[0]);else if(s===C.DRAW_LINE)k(e,C._,C._,C._,C._,c[0],c[1]);else if(s===C.CLOSE_PATH)k(e,C._,C._,C._,C._,e.current[0],e.current[1]);else if(s===C.DRAW_CURVE_CUBIC_BEZIER)k(e,c[0],c[1],c[2],c[3],c[4],c[5]),e.cx=c[2],e.cy=c[3];else if(s===C.DRAW_CURVE_SMOOTH){var b=e.lc!==C.DRAW_CURVE_SMOOTH&&e.lc!==C.DRAW_CURVE_CUBIC_BEZIER;E=b?C._:f*2-e.cx,_=b?C._:v*2-e.cy,k(e,E,_,c[0],c[1],c[2],c[3]),e.cx=c[0],e.cy=c[1]}else if(s===C.DRAW_CURVE_QUADRATIC){var I=c[0],O=c[1];T=c[2],m=c[3],k(e,f+(I-f)*W.QUADRATIC_RATIO,v+(O-v)*W.QUADRATIC_RATIO,T+(I-T)*W.QUADRATIC_RATIO,m+(O-m)*W.QUADRATIC_RATIO,T,m),e.cx=I,e.cy=O}else if(s===C.DRAW_CURVE_QUADRATIC_CONTINUATION)T=c[0],m=c[1],e.lc===C.DRAW_CURVE_QUADRATIC||e.lc===C.DRAW_CURVE_QUADRATIC_CONTINUATION?(E=f+(f*2-e.cx-f)*W.QUADRATIC_RATIO,_=v+(v*2-e.cy-v)*W.QUADRATIC_RATIO,p=T+(f*2-e.cx-T)*W.QUADRATIC_RATIO,y=m+(v*2-e.cy-m)*W.QUADRATIC_RATIO):(E=p=f,_=y=v),k(e,E,_,p,y,T,m),e.cx=p,e.cy=y;else if(s===C.DRAW_ARC)for(var w=Qt.arcToCurve(f,v,c[0],c[1],c[2],c[3],c[4],c[5],c[6]),L=0;L<w.length;L+=6)k(e,w[L],w[L+1],w[L+2],w[L+3],w[L+4],w[L+5]);else Zt.raiseError(e.c," is not supported");d+=l}while(d<u.length)}return e.segments}we.parsePoints=rr;Object.defineProperty(be,"__esModule",{value:!0});var ir=q,Fe=we,sr=A,nr=/^([#|\.]|path)/i;function ar(r){if(Array.isArray(r))return{data:r,stringData:sr._};var e;if(typeof r=="string"&&nr.test(r)?r=document.querySelector(r):e=r,typeof r=="string")return{data:Fe.parsePoints(r),stringData:e};var t=r;return t.tagName.toUpperCase()==="PATH"?(e=t.getAttribute("d"),{data:Fe.parsePoints(e),stringData:e}):ir.raiseError("Unsupported element ",t.tagName)}be.convertToPathData=ar;Object.defineProperty(se,"__esModule",{value:!0});var or=be,lr=z,le=A,ur=function(){function r(e){var t=or.convertToPathData(e),i=t.data,a=t.stringData;this.data=i,this.stringData=a}return r.prototype.getData=function(){return this.data},r.prototype.getStringData=function(){return this.stringData||(this.stringData=this.render())},r.prototype.render=function(e){e===void 0&&(e=lr.round);for(var t=this.data,i=[],a=0;a<t.length;a++){var n=t[a];i.push(le.MOVE_CURSOR,e(n[0]),e(n[1]),le.DRAW_CURVE_CUBIC_BEZIER);for(var s=void 0,o=2;o<n.length;o+=6){var l=e(n[o]),u=e(n[o+1]),d=e(n[o+2]),c=e(n[o+3]),f=e(n[o+4]),v=e(n[o+5]),E=l==f&&d==f&&u==v&&c==v;(!E||s!=(s=""+l+u+d+c+f+v))&&i.push(l,u,d,c,f,v)}}return i.join(le.SPACE)},r}();se.Path=ur;Object.defineProperty(fe,"__esModule",{value:!0});var cr=ee,hr=se;function dr(r,e){return cr.interpolatePath(r.map(function(t){return new hr.Path(t)}),e||{})}fe.interpolate=dr;Object.defineProperty(de,"__esModule",{value:!0});var fr=fe;de.interpolate=fr.interpolate;var mr=se,gr=de.Path=mr.Path;const X={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>r*(2-r),easeInOutQuad:r=>r<.5?2*r*r:-1+(4-2*r)*r,easeInCubic:r=>r*r*r,easeOutCubic:r=>--r*r*r+1,easeInOutCubic:r=>r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,easeInQuart:r=>r*r*r*r,easeOutQuart:r=>1- --r*r*r*r,easeInOutQuart:r=>r<.5?8*r*r*r*r:1-8*--r*r*r*r,easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>1+--r*r*r*r*r,easeInOutQuint:r=>r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r,easeInSine:r=>1-Math.cos(r*Math.PI/2),easeOutSine:r=>Math.sin(r*Math.PI/2),easeInOutSine:r=>-(Math.cos(Math.PI*r)-1)/2,easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:1-Math.pow(2,-10*r),easeInOutExpo:r=>r===0?0:r===1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2,easeInCirc:r=>1-Math.sqrt(1-r*r),easeOutCirc:r=>Math.sqrt(1- --r*r),easeInOutCirc:r=>r<.5?(1-Math.sqrt(1-Math.pow(2*r,2)))/2:(Math.sqrt(1-Math.pow(-2*r+2,2))+1)/2,easeInBack:r=>r*r*((1.70158+1)*r-1.70158),easeOutBack:r=>--r*r*((1.70158+1)*r+1.70158)+1,easeInOutBack:r=>{const e=2.5949095;return(r*=2)<1?.5*(r*r*((e+1)*r-e)):.5*((r-=2)*r*((e+1)*r+e)+2)},easeInElastic:r=>{if(r===0)return 0;if(r===1)return 1;const e=.3,t=e/(2*Math.PI)*Math.asin(1);return-(Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/e))},easeOutElastic:r=>{if(r===0)return 0;if(r===1)return 1;const e=.3,t=e/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*r)*Math.sin((r-t)*(2*Math.PI)/e)+1},easeInOutElastic:r=>{if(r===0)return 0;if((r*=2)===2)return 1;const e=.3*1.5,t=e/(2*Math.PI)*Math.asin(1);return r<1?-.5*(Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/e)):Math.pow(2,-10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/e)*.5+1},easeOutBounce:r=>r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375,easeInBounce:r=>1-X.easeOutBounce(1-r),easeInOutBounce:r=>r<.5?(1-X.easeOutBounce(1-2*r))/2:(1+X.easeOutBounce(2*r-1))/2},Ie="M-703.8092941984535 -63.90098386146127 C-704.0763520597816 -64.41465948657691, -704.4180525933509 -62.04943193707276, -704.6104677824378 -65.44201073680819 C-704.8028829715247 -68.83458953654362, -705.1013435512815 -78.97456875285403, -704.9637853329749 -84.25645665987383 C-704.8262271146683 -89.53834456689364, -704.589649678056 -92.25655284020733, -703.7851184725982 -97.13333817892703 C-702.9805872671404 -102.01012351764673, -701.9583551113512 -107.45010323371551, -700.1365981002284 -113.51716869219206 C-698.3148410891056 -119.5842341506686, -695.8465710937803 -126.38978672762848, -692.854576405861 -133.53573092978633 C-689.8625817179418 -140.6816751319442, -686.2740402853385 -148.63827476272067, -682.1846299727131 -156.39283390513918 C-678.0952196600877 -164.1473930475577, -673.4873271054563 -172.05990209352422, -668.3181145301085 -180.06308578429736 C-663.1489019547606 -188.0662694750705, -657.3197817827187 -196.40057192323476, -651.1693545206261 -204.41193604977798 C-645.0189272585336 -212.4233001763212, -638.3490835573479 -220.37131437072378, -631.415550957553 -228.13127054355664 C-624.4820183577582 -235.8912267163895, -617.6357763947518 -243.39760651050042, -609.568158921857 -250.97167308677507 C-601.5005414489623 -258.5457396630497, -593.0586479967965 -266.03286008526703, -583.0098461201843 -273.57567000120446 C-572.9610442435721 -281.1184799171419, -561.662819416665 -289.023955061226, -549.275347662184 -296.2285325823996 C-536.887875907703 -303.43311010357326, -522.679438253175 -310.71836744796565, -508.6850155932983 -316.80313512824614 C-494.6905929334216 -322.88790280852663, -479.35297948974716 -328.3719341366817, -465.3088117029238 -332.7371386640825 C-451.2646439161004 -337.1023431914833, -437.48954127048455 -340.44736671466114, -424.42000887235804 -342.99436229265086 C-411.3504764742315 -345.5413578706406, -398.59397240096337 -347.44242251563657, -386.8916173141647 -348.0191121320209 C-375.18926222736604 -348.5958017484052, -364.27089364708365 -348.65249596885496, -354.20587835156607 -346.45449999095683 C-344.1408630560485 -344.2565040130587, -334.66563656594394 -341.6348563572863, -326.5015255410593 -334.8311362646323 C-318.3374145161747 -328.02741617197825, -310.80835036510854 -318.96869010201686, -305.22121220225824 -305.63217943503264 C-299.63407403940795 -292.2956687680484, -295.1296754834034 -274.0727397265082, -292.97869656395756 -254.81207226272704 C-290.8277176445117 -235.55140479894587, -290.2925601460474 -213.33362143707544, -292.31533868558313 -190.06817465234565 C-294.3381172251189 -166.80272786761586, -297.16983442204815 -145.93497563136975, -305.11536780117217 -115.21939155434825 C-313.0609011802962 -84.50380747732675, -329.51339504426795 -37.593181021039825, -339.98853896032733 -5.774670190216625 C-350.4636828763867 26.04384064060658, -351.079046147025 29.207456773529394, -367.96623129752857 75.69167343059098 C-384.85341644803214 122.17589008765256, -427.2363685319144 234.11218776004432, -441.31164986334886 273.1306297521529 C-455.3869311947833 312.1490717442615, -450.10622668785544 301.2794805293817, -452.4179192861354 309.80232538324253 C-454.7296118844153 318.32517023710335, -454.3099058166018 317.87991486777304, -455.1818054530284 324.26769887531793 C-456.053705089455 330.6554828828628, -457.308736407731 342.5624552154656, -457.64931710469466 348.1290294285118 C-457.98989780165834 353.69560364155797, -457.62850217241186 354.70066401384463, -457.22528963481034 357.6671441535949 C-456.8220770972088 360.6336242933452, -456.1133711865135 363.3925209702384, -455.23004187908555 365.9279102670133 C-454.3467125716576 368.4632995637882, -453.40355912145003 370.7653368282367, -451.92531379024257 372.87947993424416 C-450.4470684590351 374.99362304025163, -449.1342326330902 376.9119277067065, -446.36056989184067 378.61276890305805 C-443.5869071505911 380.31361009940963, -440.27353331537614 382.24739647534966, -435.2833373427453 383.0845271123536 C-430.2931413701145 383.92165774935756, -423.99338118227763 385.1756541051118, -416.4193940560557 383.6355527250819 C-408.84540692983376 382.09545134505197, -400.18780026766626 380.49699344255913, -389.8394145854138 373.84391883217404 C-379.49102890316135 367.19084422178895, -366.7271903481065 356.97504588115737, -354.3290799625411 343.71710506277145 C-341.93096957697566 330.45916424438553, -328.02327777004115 313.15935123316063, -315.4507522720214 294.2962739218584 C-302.8782267740017 275.4331966105562, -299.6032950975076 271.92757046841484, -278.8939269744227 230.53864119495813 C-258.1845588513378 189.14971192150145, -210.612014359554 84.5401469506534, -191.19454353351193 45.962698281118264 C-171.77707270746987 7.385249611583141, -172.82768426835023 13.463923649880684, -162.38910201817032 -0.9260508222525914 C-151.95051976799041 -15.316025294385867, -140.7072099029987 -28.680409220967654, -128.56305003243256 -40.37714855168139 C-116.4188901618664 -52.07388788239512, -101.8685033637267 -62.39528919532237, -89.52414279477341 -71.10648680653497 C-77.17978222582012 -79.81768441774757, -64.94221522803493 -86.81044369577968, -54.49688661871278 -92.644334218957 C-44.051558009390625 -98.47822474213432, -35.59125091371175 -102.45138642424112, -26.852171138840504 -106.10982994559885 C-18.11309136396926 -109.76827346695657, -10.099254332034263 -112.33228457336881, -2.062407969485321 -114.59499534710335 C5.974438393063622 -116.85770612083789, 13.778665594653223 -118.35943796852386, 21.36890703645315 -119.68609458800609 C28.95914847825308 -121.01275120748831, 36.07159511887784 -122.31150832247233, 43.479040681314245 -122.55493506399665 C50.88648624375065 -122.79836180552097, 58.600164453424476 -122.190493027696, 65.8135804110716 -121.14665503715202 C73.02699636871871 -120.10281704660804, 80.33368736817692 -118.51967688744004, 86.75953642719696 -116.29190712073279 C93.185385486217 -114.06413735402553, 98.80493389257356 -111.23854016084813, 104.36867476519183 -107.78003643690846 C109.9324156378101 -104.32153271296879, 115.4822212636534 -100.18281664479878, 120.14198166290657 -95.54088477709473 C124.80174206215975 -90.89895290939069, 128.67563521072643 -85.6822269705928, 132.32723716071087 -79.92844523068419 C135.9788391106953 -74.17466349077559, 139.18500057953824 -67.76671435858289, 142.05159336281326 -61.01819433764308 C144.9181861460883 -54.26967431670328, 147.35247796795213 -46.656771225783096, 149.52679386036107 -39.437325105045375 C151.70110975277 -32.21787898430765, 151.80143767738295 -32.070156852505384, 155.09748871726697 -17.701517613216765 C158.393539757151 -3.332878373928148, 165.78064471942545 32.14925188353558, 169.30310009966524 46.774510330686326 C172.82555547990503 61.399768777837075, 173.38853041786777 62.502151228319065, 176.23222099870577 70.05003306968774 C179.07591157954377 77.59791491105642, 182.40067555656321 85.38474304293419, 186.3652435846932 92.0618013788984 C190.32981161282316 98.7388597148626, 194.90861454658375 104.94763139115173, 200.01962916748562 110.11238308547297 C205.1306437883875 115.27713477979421, 210.5930844384591 119.5741174197281, 217.0313313101044 123.05031154482583 C223.4695781817497 126.52650566992357, 230.64190804813268 129.55212801105284, 238.6491103973574 130.9695478360594 C246.6563127465821 132.38696766106597, 255.6316747474162 133.2377934006989, 265.0745454054527 131.5548304948652 C274.5174160634892 129.8718675890315, 284.47720533318744 126.6411242863917, 295.30633434557626 120.87177040105723 C306.1354633579651 115.10241651572277, 317.6476041683253 107.1729355651965, 330.0493194797857 96.93870718285837 C342.4510347912461 86.70447880052023, 342.2475031865511 88.74600615955677, 369.7166262143387 59.46640010702845 C397.1857492421263 30.186794054500126, 468.5957053881921 -50.12593336685471, 494.86405764651136 -78.73892913231157 C521.1324099048306 -107.35192489776843, 517.2486716576236 -102.29287070070397, 527.3267397642544 -112.21157448571267 C537.4048078708852 -122.13027827072138, 545.3492916395207 -129.3619233255413, 555.3324662862963 -138.25115184236375 C565.3156409330718 -147.1403803591862, 577.1832734469696 -158.00997752113406, 587.2257876449078 -165.54694558664733 C597.268301842846 -173.0839136521606, 606.1336301975864 -177.49762201917804, 615.5875514739257 -183.4729602354434",vr={fragmentShader:`in vec2 vUv;
out vec4 fragColor;
uniform sampler2D u_texture;
uniform float u_progress;

void main() {
  vec4 color = texture(u_texture, vUv);
  // Add a slight red enhancement
  color.r = min(1.0, color.r * (1.0 + 0.2 * u_progress));
  fragColor = color;
}`,uniforms:{u_texture:null,u_progress:0}};class pr extends ce{setupLayers(){const e=ue(this.canvas),t=[this.width,this.height],{render:i,renderTargets:a}=e.add({fragmentShader:`
        uniform sampler2D surfaceTexture;
        uniform vec2 resolution;
        out vec4 FragColor;

        in vec2 vUv;

        void main() {
          float alpha = texelFetch(surfaceTexture, ivec2(gl_FragCoord.x, gl_FragCoord.y), 0).a;
          FragColor = vec4(vUv * round(alpha), 0.0, 1.0);
        }`,uniforms:{resolution:t,surfaceTexture:null}},{internalFormat:e.gl().RGBA32F,format:e.gl().RGBA,type:e.gl().FLOAT}),n=Math.ceil(Math.log2(Math.max(this.width,this.height)))+1,{render:s,renderTargets:o,uniforms:l}=e.add({fragmentShader:`
uniform vec2 oneOverSize;
uniform vec2 resolution;
uniform sampler2D inputTexture;
uniform float uOffset;
uniform int direction;
uniform bool skip;
uniform int passes;

const int MAX_TILE_SIZE = 32;

const float SQRT_2 = 1.41;

in vec2 vUv;
out vec4 FragColor;

void classic() {
  if (skip) {
    FragColor = vec4(vUv, 0.0, 1.0);
  } else {
    vec2 nearestSeed = vec2(-1.0);
    float nearestDist = 999999.9;
    vec2 pre = uOffset * oneOverSize;

    // Start with the center to try to appeal to loading in a block
    vec2 sampleUV = vUv;

    // Check if the sample is within bounds
    vec2 sampleValue = texture(inputTexture, sampleUV).xy;
    vec2 sampleSeed = sampleValue.xy;

    if (sampleSeed.x > 0.0 || sampleSeed.y > 0.0) {
      vec2 diff = sampleSeed - vUv;
      float dist = dot(diff, diff);
      if (dist < nearestDist) {
        nearestDist = dist;
        nearestSeed.xy = sampleValue.xy;
      }
    }

    // Then do the rest
    for (float y = -1.0; y <= 1.0; y += 1.0) {
      for (float x = -1.0; x <= 1.0; x += 1.0) {
        if (x == 0.0 && y == 0.0) { continue; }
        vec2 sampleUV = vUv + vec2(x, y) * pre;

        // Check if the sample is within bounds
        if (sampleUV.x < 0.0 || sampleUV.x > 1.0 || sampleUV.y < 0.0 || sampleUV.y > 1.0) { continue; }

          vec2 sampleValue = texture(inputTexture, sampleUV).xy;
          vec2 sampleSeed = sampleValue.xy;

          if (sampleSeed.x > 0.0 || sampleSeed.y > 0.0) {
            vec2 diff = sampleSeed - vUv;
            float dist = dot(diff, diff);
            if (dist < nearestDist) {
              nearestDist = dist;
              nearestSeed.xy = sampleValue.xy;
            }
          }
      }
    }

    FragColor = vec4(nearestSeed, 0.0, 1.0);
  }
}

void main() {
  classic();
}`,uniforms:{inputTexture:null,resolution:[this.width,this.height],oneOverSize:[1/this.width,1/this.height],uOffset:Math.pow(2,n-1),direction:0,passes:n,skip:!0}},{internalFormat:e.gl().RGBA32F,format:e.gl().RGBA,type:e.gl().FLOAT}),{render:u,renderTargets:d}=e.add({uniforms:{resolution:[this.width,this.height],jfaTexture:null,surfaceTexture:null},fragmentShader:`
        uniform sampler2D jfaTexture;
        uniform sampler2D surfaceTexture;
        uniform vec2 resolution;

        in vec2 vUv;
        out vec4 FragColor;

        void main() {
          ivec2 texel = ivec2(vUv.x * resolution.x, vUv.y * resolution.y);
          vec2 nearestSeed = texelFetch(jfaTexture, texel, 0).xy;
          float dist = clamp(distance(vUv, nearestSeed), 0.0, 1.0);

          // Normalize and visualize the distance
          FragColor = vec4(dist, 0.0, 0.0, 1.0);
        }`}),{uniforms:c,render:f,renderTargets:v}=e.add({uniforms:{resolution:[this.width,this.height],oneOverSize:[1/this.width,1/this.height],sceneTexture:null,distanceTexture:null,rayCount:16,maxSteps:80,sunAngle:.4,enableSun:!1,showGrain:!1,showNoise:!0},fragmentShader:`
uniform int rayCount;
uniform float sunAngle;
uniform bool showNoise;
uniform bool showGrain;
uniform bool enableSun;
uniform vec2 oneOverSize;
uniform int maxSteps;

uniform sampler2D sceneTexture;
uniform sampler2D distanceTexture;

out vec4 FragColor;
in vec2 vUv;

const float PI = 3.14159265;
const float TAU = 2.0 * PI;
const float ONE_OVER_TAU = 1.0 / TAU;
const float PAD_ANGLE = 0.01;
const float EPS = 0.001f;

const vec3 skyColor = vec3(0.02, 0.08, 0.2);
const vec3 sunColor = vec3(0.95, 0.95, 0.9);
const float goldenAngle = PI * 0.7639320225;

// Popular rand function
float rand(vec2 co) {
    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 sunAndSky(float rayAngle) {
    // Get the sun / ray relative angle
    float angleToSun = mod(rayAngle - sunAngle, TAU);

    // Sun falloff based on the angle
    float sunIntensity = smoothstep(1.0, 0.0, angleToSun);

    // And that's our sky radiance
    return sunColor * sunIntensity + skyColor;
}

bool outOfBounds(vec2 uv) {
    return uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0;
}

void main() {
    vec2 uv = vUv;

    vec4 light = texture(sceneTexture, uv);

    vec4 radiance = vec4(0.0);

    float oneOverRayCount = 1.0 / float(rayCount);
    float angleStepSize = TAU * oneOverRayCount;

    float coef = 0.0;
    float offset = showNoise ? rand(uv + coef) : 0.0;
    float rayAngleStepSize = showGrain ? angleStepSize + offset * TAU : angleStepSize;
    float minStepSize = min(oneOverSize.x, oneOverSize.y);

    // Not light source or occluder
    if (light.a < 0.1) {
        // Shoot rays in "rayCount" directions, equally spaced, with some randomness.
        for(int i = 0; i < rayCount; i++) {
            float angle = rayAngleStepSize * (float(i) + offset) + sunAngle;
            vec2 rayDirection = vec2(cos(angle), -sin(angle));

            vec2 sampleUv = uv;
            vec4 radDelta = vec4(0.0);
            bool hitSurface = false;

            // We tested uv already (we know we aren't an object), so skip step 0.
            for (int step = 1; step < maxSteps; step++) {
                // How far away is the nearest object?
                float dist = texture(distanceTexture, sampleUv).r;

                // Go the direction we're traveling (with noise)
                sampleUv += rayDirection * dist;

                if (outOfBounds(sampleUv)) break;

                if (dist <= minStepSize) {
                    vec4 sampleColor = texture(sceneTexture, sampleUv);
                    radDelta += sampleColor;
                    hitSurface = true;
                    break;
                }
            }

            // If we didn't find an object, add some sky + sun color
            if (!hitSurface && enableSun) {
                radDelta += vec4(sunAndSky(angle), 1.0);
            }

            // Accumulate total radiance
            radiance += radDelta;
        }
    } else if (length(light.rgb) >= 0.1) {
        radiance = light;
    }


    // Bring up all the values to have an alpha of 1.0.
    vec4 finalRadiance = vec4(max(light, radiance * oneOverRayCount).rgb, 1.0);
    FragColor = finalRadiance;
}`},{internalFormat:e.gl().RGBA16F}),{render:E}=e.add({fragmentShader:`
// This shader reduces color banding by adding controlled noise to smooth gradients

uniform sampler2D inputTexture;
uniform float noiseAmount;
uniform float ditherRange; // Range of colors to analyze for banding
uniform vec2 resolution;

in vec2 vUv;
out vec4 FragColor;

float random(vec2 coords) {
    return fract(sin(dot(coords.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main() {
    vec2 uv = vUv;
    
    // Sample the original color
    vec4 originalColor = texture(inputTexture, uv);
    
    // Generate controlled noise based on position
    // This helps break up banding patterns
    vec3 noise = vec3(
        random(uv + 0.07 * fract(vec2(1.0, 0.0))),
        random(uv + 0.07 * fract(vec2(0.0, 1.0))),
        random(uv + 0.07 * fract(vec2(1.0, 1.0)))
    );
    
    // Remap noise from [0,1] to [-0.5,0.5]
    noise = noise - 0.5;
    
    // Apply noise only to smooth gradients
    // First, sample neighboring pixels to detect gradients
    vec4 neighbors[4];
    neighbors[0] = texture(inputTexture, uv + vec2(1.0, 0.0) / resolution);
    neighbors[1] = texture(inputTexture, uv + vec2(-1.0, 0.0) / resolution);
    neighbors[2] = texture(inputTexture, uv + vec2(0.0, 1.0) / resolution);
    neighbors[3] = texture(inputTexture, uv + vec2(0.0, -1.0) / resolution);
    
    // Calculate color differences
    float colorDifference = 0.0;
    for (int i = 0; i < 4; i++) {
        colorDifference += distance(originalColor.rgb, neighbors[i].rgb);
    }
    colorDifference /= 4.0;
    
    // Apply more noise to areas with subtle gradient changes (where banding occurs)
    // and less noise to areas with sharp changes or flat colors
    float bandingDetection = 1.0 - smoothstep(0.0, ditherRange, colorDifference);
    
    // Apply the noise with intensity control
    vec3 finalColor = originalColor.rgb + noise * noiseAmount * bandingDetection;
    
    // Output the processed color
    FragColor = vec4(finalColor, originalColor.a);
}`,uniforms:{inputTexture:null,noiseAmount:.015,ditherRange:1,resolution:[this.width,this.height]}}),_=new Q("curve-layer",e,(O,w)=>{i({renderTarget:a[0],uniforms:{surfaceTexture:O}});let L=a[0].texture,[U,N]=o,R=U,S=l.passes;for(let F=0;F<S||S===0&&F===0;F++){const g=Math.pow(2,S-F-1);s({renderTarget:R,uniforms:{skip:S===0,inputTexture:L,uOffset:g,direction:0}}),L=R.texture,R=R===U?N:U}u({renderTarget:d[0],uniforms:{jfaTexture:R.texture,surfaceTexture:O}}),f({renderTarget:v[0],uniforms:{distanceTexture:d[0].texture,sceneTexture:O}}),E({uniforms:{inputTexture:v[0].texture}})},{ignorePanZoom:!0,extras:{uniforms:c}}),T=new Q("seed-layer",e,(O,w)=>{i({uniforms:{surfaceTexture:O}})},{x:this.width*.125,y:this.height*.125,width:this.width*.125,height:this.height*.75,isSubview:!0,renderWhenScrubbing:!0}),m=new Q("jfa-layer",e,(O,w)=>{i({renderTarget:a[0],uniforms:{surfaceTexture:O}});let L=a[0].texture,[U,N]=o,R=U,S=l.passes;for(let F=0;F<S||S===0&&F===0;F++){const g=Math.pow(2,S-F-1);s({renderTarget:R,uniforms:{skip:S===0,inputTexture:L,uOffset:g,direction:0}}),L=R.texture,R=R===U?N:U}s()},{x:this.width*.25,y:this.height*.125,width:this.width*.125,height:this.height*.75,isSubview:!0,renderWhenScrubbing:!0}),p=new Q("df-layer",e,(O,w)=>{i({renderTarget:a[0],uniforms:{surfaceTexture:O}});let L=a[0].texture,[U,N]=o,R=U,S=l.passes;for(let F=0;F<S||S===0&&F===0;F++){const g=Math.pow(2,S-F-1);s({renderTarget:R,uniforms:{skip:S===0,inputTexture:L,uOffset:g,direction:0}}),L=R.texture,R=R===U?N:U}u({uniforms:{jfaTexture:R.texture,surfaceTexture:O}})},{x:this.width*.25,y:this.height*.125,width:this.width*.125,height:this.height*.75,isSubview:!0,renderWhenScrubbing:!0}),y=ue(this.canvas),b=y.add(vr),I=new Q("polygon-layer",y,(O,w)=>{b.render({uniforms:{u_texture:O,u_progress:w}})},{});this.pushLayer(_),this.pushLayer(m),this.pushLayer(p),this.pushLayer(T),this.pushLayer(I)}*animationSequence(){const{width:e,height:t}=this.canvas;this.animate([{layer:"background",draw(s,o){s.fillStyle="#181818",s.fillRect(0,0,e,t)}}],{duration:0});const i=this.canvas.width/2,a=this.canvas.height/2,n=`M ${e*.5} ${t*.6}
                         L ${e*.5} ${t*.8}
                         L ${e*.9} ${t*.9}
                         L ${e*.5} ${t*.9}Z`;this.animate([{layer:["curve-layer","seed-layer","jfa-layer","df-layer"],draw(s,o,{layers:l}){l["curve-layer"].extras&&(l["curve-layer"].extras.uniforms.enableSun=!1),l["seed-layer"].x=e*.125+o*e*.25,l["jfa-layer"].x=e*.25+o*e*.25,l["df-layer"].x=e*.375+o*e*.25,s.save(),s.translate(i,a),s.scale(e/1920,t/1080);const d=new gr(Ie).getData()[0].length*8,c=new Path2D(Ie);s.strokeStyle="#3498db",s.lineWidth=8,s.setLineDash([o*d,d]),s.lineDashOffset=0,s.lineWidth=16,s.lineCap="round",s.lineJoin="round",s.stroke(c),s.restore();const f=new Path2D(n);s.fillStyle="#000000",s.fill(f),s.fillStyle="#000000",s.font="96px serif",s.fillText("Hello",e*.65,t*.25)}}],{duration:5,easing:X.easeInOutCubic,delay:0}),this.animate([{layer:"curve-layer",draw(s,o,l){l.layers["seed-layer"].height=o===0?t*.75:(1-o)*(t*.75),l.layers["jfa-layer"].height=o===0?t*.75:(1-o)*(t*.75),l.layers["jfa-layer"].y=o===0?t*.125:t*.5-(1-o)*(t*.75)/2;const u=t*.75,d=o===0?u:(1-o)*u;l.layers["df-layer"].height=d,l.layers["df-layer"].y=t*.125+(u-d)}}],{duration:1,easing:X.easeInOutCubic,parallel:!0}),this.animate([{layer:"curve-layer",draw(s,o,{layers:l}){l["curve-layer"].extras&&(l["curve-layer"].extras.uniforms.sunAngle=0,l["curve-layer"].extras.uniforms.enableSun=!0)}}],{duration:0,easing:X.easeInOutCubic,delay:.5,parallel:!0}),this.animate([{layer:"curve-layer",draw(s,o,{layers:l}){l["curve-layer"].extras&&(l["curve-layer"].extras.uniforms.sunAngle=o*2*3.14)}}],{duration:1,easing:X.easeInOutCubic,delay:.5}),this.animate([{layer:"polygon-layer",draw(s,o){const l=new Path2D(n),u=Math.floor(231*o),d=Math.floor(76*o),c=Math.floor(60*o),f=o;s.fillStyle=`rgba(${u}, ${d}, ${c}, ${f})`,s.fill(l)}}],{duration:.3,easing:X.easeInOutCubic,delay:0})}}document.addEventListener("DOMContentLoaded",async()=>{const r=document.querySelector("#preview");if(!r)return;const e=document.createElement("canvas");r.append(e);const t=new Qe,i=new pr({width:1920,height:1080,canvas:e});t.setScene(i),await t.initialize(r)});
